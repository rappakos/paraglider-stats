{% extends "base.html" %}

{% set title = "Gliders" %}

{% block content %}
<h2>XContest 2023</h2>

<div class="w3-row">
   
    <div class="w3-container w3-twothird">
        <details>
            <summary>
            Notes for the table.
            </summary>
            Table of all gliders that have at least 50 flights.
            Statistics for gliders with less than 200 flights are less reliable.
            Unlcassified (no normalized glider name) are not included.
        </details>
        <hr />
        <form action="/gliders" method="get" class="w3-container" autocomplete="off">
            <button type="submit" class="btn btn-success" >
             <i class="fa fa-filter"></i> Filter table
            </button>
        <br />
        <input type="checkbox" name="export" id ="export" />
        <label for="export">Export to excel</label>

        <table class="w3-table w3-bordered">
            <tr>
                <th></th>
                <th>Glider</th>
                <th width="20px">Class</th>
                <th>Count</th>
                <th colspan="3">Log-Normal params</th>
                <th colspan="3">P( xc &gt;= X )</th>
            </tr>
            <tr>
                <th></th>
                <th><input id="glider" name="glider" type="text" value="{{filter.glider}}" /></th>
                <th width="20px"><input id="class" name="class" type="text" value="{{filter.class}}" /></th>
                <th></th>
                <th>mu</th>
                <th>sigma</th>
                <th>log-theta</th>
                <th>X=50</th>
                <th>X=100</th>
                <th>X=200</th>
            </tr>
            {% for glider in gliders %}
                <!-- 1.96 * sqrt( 0.8^2 / 200) approx 0.11 -->
                {% if glider.confidence <= 0.11 %}
                    <tr class="">
                {% elif glider.confidence <= 0.165 %} 
                        <tr class="w3-sand">        
                <!-- 1.96 * sqrt( 0.8^2 / 50) approx 0.22 -->                
                {% elif glider.confidence <= 0.22 %} 
                    <tr class="w3-pale-yellow">
                {% else %} 
                    <tr class="w3-pale-red">
                {% endif %}
                <td>
                    {% if glider.glider_norm.lower().replace(' ','-') in filter.compare %}
                        <input type="checkbox" name="{{glider.glider_norm.lower().replace(' ','-')}}" checked />
                    {% else %}
                        <input type="checkbox" name="{{glider.glider_norm.lower().replace(' ','-')}}" />
                    {% endif %}
                </td>
                <td><a href="/gliders/{{ glider.glider_norm.lower().replace(' ','-') }}">{{ glider.glider_norm }}</a></td>
                <td width="20px" >{{ glider.class }}</td>
                <td>{{ glider.count }}</td>
                <td>{{  '{0:0.4f}'.format(glider.mu) }}</td>
                <td>{{  '{0:0.4f}'.format(glider.sigma) }}</td>
                <td>{{  '{0:0.4f}'.format(glider.mu + 0.5*glider.sigma**2) }} &plusmn; {{  '{0:0.4f}'.format(glider.confidence ) }} </td>
                <td>{{ (glider.p50*100)|round|int }} %</td>
                <td>{{ (glider.p100*100)|round|int }} %</td>
                <td>{{ (glider.p200*100)|round|int }} %</td>
            </tr>    
            {% endfor %}
        </table>
        </form>
    </div>


    <div class="w3-container w3-third">
        {% if comparison %}
         <img src="{{comparison}}"/>
        {% endif %}

        <h3>Top unclassified</h3>
        <form action="/gliders" method="get" class="w3-container" autocomplete="off">
            <input type="text" id="unclass" name="unclass" value="{{filter.unclass}}" />
            <button type="submit" class="btn btn-success" >
             <i class="fa fa-filter"></i> Filter unclassified
            </button>
        </form>
        <table class="w3-table w3-bordered">
            <tr>
                <th>Glider</th>
                <th>Count</th>
            </tr>
            {% for glider in unclass_gliders %}
            <tr>
                <td>{{ glider.glider }}</td>
                <td>{{ glider.flight_count }}</td>
            </tr>    
            {% endfor %}
        </table>
    </div>

</div>

{% endblock %}